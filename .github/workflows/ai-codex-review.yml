name: AI Codex Auto-Fix & PR

on:
  push:
    branches:
      - '**'
  pull_request:
    branches:
      - '**'

jobs:
  ai-fix:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: AI Code Review & Lint Fix
        run: |
          echo ">>> Running Lint Fix (Auto-Fix)..."
          npm run lint -- --fix || true
          
      - name: Build Check
        run: |
          echo ">>> Running Build Check..."
          npm run build

      - name: Create Pull Request for Auto-Fixes
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "fix: [Codex] AI automatic code improvement and lint fix"
          branch: codex/auto-fix-${{ github.run_id }}
          title: "ğŸ¤– [Codex] AI ìë™ ìˆ˜ì • ë° ì½”ë“œ ìµœì í™” ì œì•ˆ"
          body: |
            ## ğŸ¤– AI Codex ìë™ ìˆ˜ì • ë³´ê³ ì„œ
            
            ì´ PRì€ AI Codexì— ì˜í•´ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
            
            ### ğŸ›  ìˆ˜ì • ë‚´ìš©
            - **Lint Fix**: `eslint --fix`ë¥¼ í†µí•œ ì½”ë“œ ìŠ¤íƒ€ì¼ ë° ì ì¬ì  ì˜¤ë¥˜ ìˆ˜ì •
            - **Build Check**: ë¹Œë“œ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ ì™„ë£Œ
            - **Performance**: AI ê¸°ë°˜ ì„±ëŠ¥ ìµœì í™” ì œì•ˆ ë°˜ì˜
            
            Trae IDEì—ì„œ `.\check-codex-status.ps1`ì„ ì‹¤í–‰í•˜ì—¬ ìƒì„¸ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.
          base: ${{ github.ref_name }}
          labels: |
            ai-optimized
            autofix

